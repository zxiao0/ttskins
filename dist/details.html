<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1">
    <meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
    <meta content="yes" name="apple-mobile-web-app-capable" />
    <title></title>   
    <link rel="stylesheet" type="text/css" href="static/css/app.css" /> 
</head>
<body>
  <div class="header" id="header">
    <div class="header-bg">
      <div class="logo fl"><a href="javascript:;"><img src="static/images/comm/logo.png?v=1548410201598"></a></div> 
      <div class="menu fl">

          <a href="javascript:;" class="active">
              <span class="img">
                  <span class="icon boxIcon"></span>
              </span>
              <span>箱子</span>
          </a>

          <a href="javascript:;">
              <span class="img">
                  <span class="icon CFIcon"></span>
              </span>
              <span>众筹</span>
          </a>
          <a href="javascript:;">
              <span class="img">
                  <span class="icon rollIcon"></span>
              </span>
              <span>ROLL</span>
          </a>
          <a href="javascript:;">
              <span class="img">
                  <span class="icon MALLIcon"></span>
              </span>
              <span>商城</span>
          </a>
      </div>
      <div class="shortcut fr">
          <div class="language fl">
              <div class="selectCa">
                  
                  <div class="val" @click="show_lang()"><img src="static/images/comm/chinese.jpg?v=1548410201598"></div>
                  <div class="optionList" v-show="islang">
                      <div class="option" @click="set_lang('en')"><img src="static/images/comm/english.jpg"></div>
                      <div class="option" @click="set_lang('zh-hans')"><img src="static/images/comm/chinese.jpg?v=1548410201598"></div>
                  </div>
              </div>
          </div>
          <div class="user fl">
              
              <div class="discard">
                  <a href="javascript:void 0;" id="login_page">登录</a>
                  <a href="javascript:void 0;" id="reg_page">注册</a>
              </div>
              
          </div>
      </div>
    </div>
  </div> 

  


  <div class="drop-top">
        
    <!--content-->
    <div class="drop-lf">
      <div class="hd">
        <a href="javascript:;" id="order_time">实时掉落</a> 
        <a href="javascript:;" id="order_day">今日最佳</a>
      </div> 
      <p>隐秘掉落：<span>1250500</span></p>
    </div> 


    <div class="drop-rg">
      <div class="item active">
        <div class="swiper-container">
          <ul class="swiper-wrapper" >
            <li class="swiper-slide" >
              <a>
                <span class="info">
                  <i class="icon"></i>
                  <img src="static/images/upload/img01.png?v=1548410201598">
                  <em>Ak-47 Jungle Spray</em>
                  <span class="price">￥121</span>
                </span>
                <span class="userinfo"><img src="static/images/upload/head.png?v=1548410201598"><em class="name">德玛西亚</em>
                </span>
              </a>
            </li>
            <li class="swiper-slide" >
              <a>
                <span class="info">
                  <i class="icon"></i>
                  <img src="static/images/upload/img02.png?v=1548410201598">
                  <em>Ak-47 Jungle Spray</em>
                  <span class="price">￥121</span>
                </span>
                <span class="userinfo"><img src="static/images/upload/head.png?v=1548410201598"><em class="name">德玛西亚</em>
                </span>
              </a>
            </li>
            <li class="swiper-slide" >
              <a>
                <span class="info">
                  <i class="icon"></i>
                  <img src="static/images/upload/img03.png?v=1548410201598">
                  <em>Ak-47 Jungle Spray</em>
                  <span class="price">￥121</span>
                </span>
                <span class="userinfo"><img src="static/images/upload/head.png?v=1548410201598"><em class="name">德玛西亚</em>
                </span>
              </a>
            </li>
            <li class="swiper-slide" >
              <a>
                <span class="info">
                  <i class="icon"></i>
                  <img src="static/images/upload/img04.png?v=1548410201598">
                  <em>Ak-47 Jungle Spray</em>
                  <span class="price">￥121</span>
                </span>
                <span class="userinfo"><img src="static/images/upload/head.png?v=1548410201598"><em class="name">德玛西亚</em>
                </span>
              </a>
            </li>
            <li class="swiper-slide" >
              <a>
                <span class="info">
                  <i class="icon"></i>
                  <img src="static/images/upload/img05.png?v=1548410201598">
                  <em>Ak-47 Jungle Spray</em>
                  <span class="price">￥121</span>
                </span>
                <span class="userinfo"><img src="static/images/upload/head.png?v=1548410201598"><em class="name">德玛西亚</em>
                </span>
              </a>
            </li>
            <li class="swiper-slide" >
              <a>
                <span class="info">
                  <i class="icon"></i>
                  <img src="static/images/upload/img06.png?v=1548410201598">
                  <em>Ak-47 Jungle Spray</em>
                  <span class="price">￥121</span>
                </span>
                <span class="userinfo"><img src="static/images/upload/head.png?v=1548410201598"><em class="name">德玛西亚</em>
                </span>
              </a>
            </li>
            <li class="swiper-slide" >
              <a>
                <span class="info">
                  <i class="icon"></i>
                  <img src="static/images/upload/img07.png?v=1548410201598">
                  <em>Ak-47 Jungle Spray</em>
                  <span class="price">￥121</span>
                </span>
                <span class="userinfo"><img src="static/images/upload/head.png?v=1548410201598"><em class="name">德玛西亚</em>
                </span>
              </a>
            </li>
            <li class="swiper-slide" >
              <a>
                <span class="info">
                  <i class="icon"></i>
                  <img src="static/images/upload/img08.png?v=1548410201598">
                  <em>Ak-47 Jungle Spray</em>
                  <span class="price">￥121</span>
                </span>
                <span class="userinfo"><img src="static/images/upload/head.png?v=1548410201598"><em class="name">德玛西亚</em>
                </span>
              </a>
            </li>
            <li class="swiper-slide" >
              <a>
                <span class="info">
                  <i class="icon"></i>
                  <img src="static/images/upload/img09.png?v=1548410201598">
                  <em>Ak-47 Jungle Spray</em>
                  <span class="price">￥121</span>
                </span>
                <span class="userinfo"><img src="static/images/upload/head.png?v=1548410201598"><em class="name">德玛西亚</em>
                </span>
              </a>
            </li>
            <li class="swiper-slide" >
              <a>
                <span class="info">
                  <i class="icon"></i>
                  <img src="static/images/upload/img07.png?v=1548410201598">
                  <em>Ak-47 Jungle Spray</em>
                  <span class="price">￥121</span>
                </span>
                <span class="userinfo"><img src="static/images/upload/head.png?v=1548410201598"><em class="name">德玛西亚</em>
                </span>
              </a>
            </li>
          </ul>
        </div> 
      </div>
    </div>

  </div>





  <div id="details">
    <div class="lottery">
      <div class="circlefont">满8增1</div>
      <div class="circleinfo" id="circleinfo">
          <div class="circle">
            <div class="circle-left"></div>
            <div class="circle-right"></div>
            <div class="circle-bottom-left"></div>
            <div class="circle-bottom-right"></div>
          </div>
          <div class="info">1/8</div>
      </div>
      <div class="caseh"><h3>箱子名字</h3>OPENED CASE</div>
      <div class="canvasBox" id="canvasContext"></div>
      <div class="lotteryB">
        <div class="allprice">总计：<span>1.99 V币</span></div>
        <div class="selectCa">
            打开个数：
            <span class="val" data-value="1">1</span>
            <span data-value="2">2</span>
            <span data-value="3">3</span>
        </div>
        <div class="Play">
            <a id="play" class="btn" href="javascript:void(0)">立即打开</a>
        </div>
      </div>
    </div>
    <div class="dropBox">
      <div class="dropBox_t">
        <h3>箱子内容</h3>
        <p>该箱子共有<span>XX</span>件物品</p>
      </div>
      <div class="dropBox_b">
        <ul class="scrollbarArea">
          <li class="weaponItem">
            <div class="weaponR">出奖率:5%</div>
            <div class="weaponImg">
                <img src="static/images/upload/list02-img01.png?v=1548410201598">
            </div>
            <div class="weaponName">Ak-47 Jungle Spray</div>
            <div class="weaponPrice">￥121</div>
          </li>
          <li class="weaponItem">
            <div class="weaponR">出奖率:5%</div>
            <div class="weaponImg">
                <img src="static/images/upload/list02-img02.png?v=1548410201598">
            </div>
            <div class="weaponName">Ak-47 Jungle Spray</div>
            <div class="weaponPrice">￥121</div>
          </li>
          <li class="weaponItem">
            <div class="weaponR">出奖率:5%</div>
            <div class="weaponImg">
                <img src="static/images/upload/list02-img03.png?v=1548410201598">
            </div>
            <div class="weaponName">Ak-47 Jungle Spray</div>
            <div class="weaponPrice">￥121</div>
          </li>
          <li class="weaponItem">
            <div class="weaponR">出奖率:5%</div>
            <div class="weaponImg">
                <img src="static/images/upload/list02-img04.png?v=1548410201598">
            </div>
            <div class="weaponName">Ak-47 Jungle Spray</div>
            <div class="weaponPrice">￥121</div>
          </li>
          <li class="weaponItem">
            <div class="weaponR">出奖率:5%</div>
            <div class="weaponImg">
                <img src="static/images/upload/list02-img05.png?v=1548410201598">
            </div>
            <div class="weaponName">Ak-47 Jungle Spray</div>
            <div class="weaponPrice">￥121</div>
          </li>
          <li class="weaponItem">
            <div class="weaponR">出奖率:5%</div>
            <div class="weaponImg">
                <img src="static/images/upload/list02-img06.png?v=1548410201598">
            </div>
            <div class="weaponName">Ak-47 Jungle Spray</div>
            <div class="weaponPrice">￥121</div>
          </li>
          <li class="weaponItem">
            <div class="weaponR">出奖率:5%</div>
            <div class="weaponImg">
                <img src="static/images/upload/list02-img07.png?v=1548410201598">
            </div>
            <div class="weaponName">Ak-47 Jungle Spray</div>
            <div class="weaponPrice">￥121</div>
          </li>
          <li class="weaponItem">
            <div class="weaponR">出奖率:5%</div>
            <div class="weaponImg">
                <img src="static/images/upload/list02-img08.png?v=1548410201598">
            </div>
            <div class="weaponName">Ak-47 Jungle Spray</div>
            <div class="weaponPrice">￥121</div>
          </li>
        </ul>
      </div>
  </div>
    
  </div>
  <div class="footer">
      <div class="logo fl"><a href="/"><img src="static/images/comm/logo.png?v=1548410201598"></a></div>
      <div class="entrance fr">
          <a class="help" href="javascript:;"><i></i>帮助中心</a>
          <a class="terms" href="javascript:;"><i></i>使用条款</a>
      </div>
      <div class="payType fl">
          <span class="tit"><i></i>支付方式：</span>
          <span class="type">
              <i class="zfb"></i>
              <i class="wx"></i>
              <i class="yl"></i>
          </span>
      </div>
  </div>
  <script src="static/js/vendor/vue-2.4.2.js?v=1548410201598"></script> 
  <script src="static/js/vendor/axios.min.js?v=1548410201598"></script> 
  <script src="static/js/vendor/vee-validate.js?v=1548410201598"></script> 
  <script src="static/js/vendor/jquery-3.2.1.js?v=1548410201598"></script> 
  <script src="static/js/comm.js?v=1548410201598"></script>
  <script type="text/javascript" src="static/js/unpack_show.js"></script>

  <script> 
 
  
  new Vue ({
      el: "#details",
      components: {
      },
      data: function() {
          return {
            isAjaxLock:false
          }
      }, 
      extends: {

      },
      methods: {
          

      }, 
      mounted: function() {
          
        var per = 0.2;
        var right = document.getElementById("circleinfo").getElementsByClassName('circle-right')[0];
        var left = document.getElementById("circleinfo").getElementsByClassName('circle-left')[0];
        
        if (per <= 0.5) {  //红色区域不超过一半
            right.style.transform = `rotate(${per * 360}deg)`
        } else {    //红色区域超过一半的情况，重点部分
            right.style.transform = `rotate(180deg)`
            right.style.transition = `opacity 0s step-end 1s, transform 1s linear` //timing-function需要设为linear来达到视觉上的平缓过渡
            right.style.opacity = 0

            left.style.transition = `transform ${(per - 0.5) / 0.5}s linear 1s`
            left.style.transform = `rotate(${per * 360 - 180}deg)`
        }
          
          
    
      }
  })
  </script>

  <script type="text/javascript">
        var all_items_ids = new Array();
        var dataArray = new Array();
        var idMap = new Array();

        function addDefaultData(object) {
            all_items_ids["id_" + object.id] = object;
            if (dataArray.length < 10 || object.id == -10240000) {
                dataArray.push(object);
                idMap["id_" + object.id] = true;
            }
        }

        var failed = {id: -1, title: "Case Fail", img: "/static/csgo/images/failCase.png", color: "#000"};
        
        addDefaultData({
            id:431,
            title: "AWP | Asiimov",
            img: "static/images/upload/list02-img01.png"
        });
        addDefaultData({
            id:432,
            title: "AWP | Asiimov",
            img: "static/images/upload/list02-img02.png"
        });
        addDefaultData({
            id:432,
            title: "AWP | Asiimov",
            img: "static/images/upload/list02-img03.png"
        });
        addDefaultData({
            id:432,
            title: "AWP | Asiimov",
            img: "static/images/upload/list02-img04.png"
        });
        addDefaultData({
            id:432,
            title: "AWP | Asiimov",
            img: "static/images/upload/list02-img05.png"
        });
        addDefaultData({
            id:432,
            title: "AWP | Asiimov",
            img: "static/images/upload/list02-img06.png"
        });
        addDefaultData({
            id:432,
            title: "AWP | Asiimov",
            img: "static/images/upload/list02-img07.png"
        });
        addDefaultData({
            id:432,
            title: "AWP | Asiimov",
            img: "static/images/upload/list02-img08.png"
        });
        addDefaultData({
            id:432,
            title: "AWP | Asiimov",
            img: "static/images/upload/list02-img09.png"
        });
        addDefaultData({
            id:432,
            title: "AWP | Asiimov",
            img: "static/images/upload/list02-img10.png"
        });
        //自动开关
        var isAuto = false;
        var num = 1, timer = null;
        var currentWatingCount = 0;
        var currentCanvasCount = 1;
        var canvasList = new Array();
        var box_item_ids = null;
        var skin_item = false, test_span = false, false_balance = false;
        var success_name = "", success_order_id = "", success_image = "", success_price = "", item_unit_price = "";
        var voucher_amount = 0, wallet_current_balance = 0, sell_price_currency = 0, total_sell_price = 0;
        var trade_id = 0;

        //启动回调
        function onCanvasStart(canvas, datas) {
        }

        //结束回调
        function onCanvasStop(canvas, data) {
            currentWatingCount--;
            if (currentWatingCount < 1) {
                if (skin_item) {
                    if (num == 1 && box_item_ids.length > 0) {
                        //弹出窗口
                        layer.open({
                            type: 1,
                            title: false,
                            skin: 'Popstyle',
                            closeBtn: 1,
                            content: $('#js_case_open'),
                            shade: [0.7, '#161720'],
                            area: ['auto', '450px'],
                            success: function () {
                                $("#wallet_current_balance").html(wallet_current_balance);
                            }
                        });
                    } else if (num > 1 && box_item_ids.length > 0) {
                        //弹出窗口
                        layer.open({
                            type: 1,
                            title: false,
                            skin: 'Popstyle',
                            closeBtn: 1,
                            content: $('#js_openMPop'),
                            shade: [0.7, '#161720'],
                            area: ['auto', '550px'],
                            success: function (index, layero) {
                                $("#wallet_current_balance").html(wallet_current_balance);
                            }
                        });
                    }
                    //如果是自动开箱，2秒后关闭弹窗
                    if (isAuto) {
                        timer = setTimeout(function () {
                            clearInterval(timer);
                            layer.closeAll();
                            //createCanvas();
                            console.log(1);
                            $("#openBtn").click();
                        }, 1000)
                    } else {
                        $('.isAuto_l').removeClass('active');
                    }
                    skin_item = false;
                } else if (test_span) {
                    test_span = false;
                } else if (false_balance) {
                    //开箱充值弹窗
                    setTimeout(function () {
                        location.herf = '/wallet/recharge';
                    }, 2000);
                    layer.msg('余额不足');
                    false_balance = false;
                }
                //禁止按钮恢复
                $('#openBtn').removeClass("disabled");
                $('#openBtn').css("cursor", "pointer");
                $("#test_spin_open_case").removeClass("disabled");
                $("#test_spin_open_case").css("cursor", "pointer");
            }
        }

        function createCanvas() {
            while (canvasList.length > 0) {
                canvasList.splice(0, 1);
            }
            var canvasContext = document.getElementById("canvasContext");
            canvasContext.innerHTML = "";
            var bgPanel = null;
            var padPanel = null;
            for (var index = 0; index < currentCanvasCount; index++) {
                bgPanel = document.createElement("div");
                bgPanel.className = "canvasItem";
                canvasContext.appendChild(bgPanel);
                padPanel = document.createElement("div");
                padPanel.className = "canvasContext";
                bgPanel.appendChild(padPanel);
                canvasList[index] = new UnpackCanvas(dataArray, (new Date().getTime() + "_" + index));
                canvasList[index].write(padPanel);
                canvasList[index].onStart = onCanvasStart;
                canvasList[index].onStop = onCanvasStop;
            }
            currentWatingCount = currentCanvasCount;
        }

        function doCanvasStart() {
            for (var index = 0; index < canvasList.length; index++) {
                canvasList[index].start();
                canvasList[index].over(1);
            }
        }

        function doCanvasOver(results) {
            for (var index = 0; index < canvasList.length; index++) {
                if (index + 1 > results.length) {
                    canvasList[index].over(-1);
                }
                else {
                    canvasList[index].over(results[index]);
                }
            }
        }

        $(function () {
            //多开渲染
            createCanvas();
            $(document).on("click", ".selectCa .option", function (e) {
                num = parseInt($(this).data('value'));
                $(this).parents(".selectCa").find(".val").html($(this).html());
                $(this).parents(".optionList").slideUp(100);
                e.stopPropagation();
                if (isNaN($(this).html())) {
                    currentCanvasCount = 1;
                }
                else {
                    currentCanvasCount = parseInt($(this).html());
                    if (currentCanvasCount < 1) {
                        currentCanvasCount = 1;
                    }
                }
                createCanvas();
                //选中数值显示

                var box_price = '34.00';
                $("#cases_total_price").text(utils.round(parseFloat(box_price) * parseInt(num), 2));
            });
            
            select_all_items_ids = function () {
                var id_list = [];
                $('#canvasContext .UnpackCanvas_Container li').each(function () {
                    if (!utils.isEmpty($(this).data("id"))) {
                        id_list.push($(this).data("id"));
                    }
                });
                return id_list;
            };
            // 立即打开
            $("#play").click(function () {
                
                if (!$(this).hasClass("disabled")) {
                    $(this).addClass("disabled");
                    test_span = true;
                    createCanvas();
                    doCanvasStart();
                    var id_list = select_all_items_ids();
                    var test_box_items_ids = [];
                    for (var i = 1; i <= num; i++) {
                        var index = Math.floor((Math.random() * id_list.length));
                        test_box_items_ids.push(id_list[index]);
                    }
                    setTimeout(function () {
                        doCanvasOver(test_box_items_ids);
                    }, 2000);
                }
            });
    

 


        })

    </script>
</body>
</html>