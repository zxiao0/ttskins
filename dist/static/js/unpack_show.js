function UnpackCanvas(t,e){var n=this;this.baseWidth=0,this.flag=e,this.datas=t,this.container=document.createElement("DIV"),this.container.className="UnpackCanvas_Container",this.list=document.createElement("UL"),this.line=document.createElement("DIV"),this.uiList=new Array,this.uiMap=new Array,this.currentIndex=-1,this.parentElement=null,this.targetElement=null,this.attachElement=null,this.currentLI=null,this.stepSize=0,this.stepTime=2,this.actived=!1,this.rolledCount=0,this.totalRollCount=0,this.totalStepSize=0,this.totalLeft=0,this.listener=null,this.stepRate=4,this.onStart=null,this.onStop=null,this.getWidth=function(t){return t=t?t:this.container,t.offsetWidth},this.getHeight=function(t){return t=t?t:this.container,t.offsetHeight},this.getLeft=function(t){return t=t?t:this.container,t.clientLeft},this.getTop=function(t){return t=t?t:this.container,t.offsetTop},this.getMarginLeft=function(t){return t=t?t:this.container,left=t.style.marginLeft,left=left.replace("px",""),left.length<1&&(left="0"),parseInt(left)},this.setMarginLeft=function(t,e){t=t?t:this.container,t.style.marginLeft=e+"px"},this.getStyleLeft=function(t){return t=t?t:this.container,left=t.style.left,left=left.replace("px",""),left.length<1&&(left="0"),parseInt(left)},this.getAbsoluteLeft=function(t){var e=0;t=t?t:this.container;for(var i=t;i;)e+=i.offsetLeft,i=i.offsetParent;return e},this.getAbsoluteTop=function(t){var e=0;t=t?t:this.container;for(var i=t;i;)e+=i.offsetTop,i=i.offsetParent;return e},this.looping=function(){var t=n.getMarginLeft(n.currentLI);n.setMarginLeft(n.currentLI,t-n.stepSize),t<=-n.baseWidth&&(n.list.removeChild(n.currentLI),n.list.appendChild(n.currentLI),n.uiList.splice(0,1),n.uiList.push(n.currentLI),n.setMarginLeft(n.currentLI,0),n.currentLI=null),null==n.currentLI&&(n.currentLI=n.uiList[0]),null==n.targetElement?window.setTimeout(n.looping,n.stepTime):n.uiList[n.uiList.length-1]==n.targetElement?n.complet(!0):window.setTimeout(n.looping,n.stepTime)},this.complet=function(t){var e=n.getStyleLeft(n.line),i=n.getAbsoluteLeft(n.targetElement)-n.getAbsoluteLeft(n.container),s=i-e;if(t&&(n.totalStepSize=n.stepSize,n.totalLeft=s),s>-n.baseWidth/2){var l=s/n.totalLeft;l>.1&&(n.stepSize=parseInt(n.totalStepSize*l)),null==n.currentLI&&(n.currentLI=n.uiList[0]),s=n.getMarginLeft(n.currentLI),n.setMarginLeft(n.currentLI,s-n.stepSize),s<=-n.baseWidth&&(n.list.removeChild(n.currentLI),n.list.appendChild(n.currentLI),n.uiList.splice(0,1),n.uiList.push(n.currentLI),n.setMarginLeft(n.currentLI,0),n.currentLI=null),window.setTimeout(n.complet,n.stepTime)}else{n.targetElement.className="selected";try{n.onStop&&n.onStop(n,{id:n.targetElement.getAttribute("data-id"),title:n.targetElement.getAttribute("data-title")})}catch(a){}n.actived=!1,n.currentLI=null,n.targetElement=null,n.rollByCount=0,n.totalRollCount=0,n.stepSize=parseInt(n.baseWidth/n.stepRate),n.totalStepSize=0,n.totalLeft=0,n.stepTime=10}},this.start=function(){if(!(this.datas.length<1||this.actived)){if(this.list.style.width=this.uiList.length*this.baseWidth+"px",this.actived=!0,null!=this.attachElement){for(this.list.removeChild(this.attachElement),this.uiMap[this.attachElement.id]=null,i=0;i<this.uiList.length;i++)if(this.uiList[i]==this.attachElement){this.uiList.splice(i,1);break}this.attachElement=null}null==this.currentLI&&(this.currentLI=n.uiList[0]),this.onStart&&this.onStart(this,t),this.looping()}},this.over=function(t){this.actived&&null==this.targetElement&&("object"==typeof t?(console.log(1),this.attachElement=this.createBox("append_unpackbox_",this.flag,t),this.targetElement=this.attachElement,this.list.style.width=this.uiList.length*this.baseWidth+"px"):(console.log(2),this.targetElement=document.getElementById("unpackbox_"+this.flag+t)))},this.init=function(){for(n.container.appendChild(n.list),i=0;i<n.datas.length;i++)n.createBox("unpackbox_",n.flag,n.datas[i]);for(var t=n.baseWidth*n.datas.length,e=1,s=n.getWidth();this.datas.length>0&&s+t-t*e>=t;){for(i=0;i<n.datas.length;i++)n.createBox("clone_unpackbox_",n.flag,n.datas[i]);e++}n.list.style.width=n.uiList.length*n.baseWidth+"px",null==n.line.offsetParent&&(n.container.appendChild(n.line),n.line.className="line",n.line.style.left=parseInt(n.getWidth()/2)+"px"),this.adjust()},this.createBox=function(t,e,i){var n=document.createElement("LI");n.id=t+e+i.id,n.setAttribute("data-id",i.id),n.setAttribute("data-title",i.title);var s=document.createElement("IMG");s.src=i.img,s.title=i.title;var l=document.createElement("SPAN");l.innerHTML=i.title;var a=document.createElement("DIV");return a.appendChild(s),n.appendChild(a),n.appendChild(l),this.list.appendChild(n),this.currentIndex++,n.index=this.currentIndex,this.uiList.push(n),this.uiMap[n.id]=n,0==this.baseWidth&&(this.baseWidth=this.getWidth(n),this.stepSize=parseInt(this.baseWidth/this.stepRate)),n},this.destroy=function(){this.container.parentNode&&this.container.parentNode.removeChild&&(this.container.parentNode.removeChild(this.listener),this.container.parentNode.removeChild(this.container))},this.adjust=function(){var t=n.getWidth(n.list);n.list.style.width=t+"px",n.line.style.left=parseInt(n.getWidth()/2)+"px"},this.write=function(t){this.parentElement="string"==typeof t?document.getElementById(t):t,this.parentElement.appendChild(this.container),this.init(),this.listener=document.createElement("iframe"),this.listener.width="100%",this.listener.height=0,this.listener.frameBorder=0,this.container.appendChild(this.listener),this.listener.contentWindow.binded=n,this.listener.contentWindow.onresize=function(){n.adjust()}}}